async function initializeLandingPageRedirection() { try { const t = await fetchConfig(); "loading" === document.readyState ? document.addEventListener("DOMContentLoaded", (() => applyClasses(t))) : applyClasses(t), setupClickHandler(t) } catch (t) { console.error("Initialization failed:", t) } } async function fetchConfig() { const t = await fetch("https://growthatkyte.github.io/web/scripts/landing-pages-list.json"); if (!t.ok) throw new Error("Failed to fetch landing pages configuration"); return t.json() } function applyClasses(t) { const e = normalizePath(window.location.pathname); document.querySelectorAll('input[type="submit"], button[type="submit"]').forEach((n => { t[e] && (n.classList.add(t[e].redirectClass), console.log(`Applied '${t[e].redirectClass}' to buttons for path: ${e}`)) })) } function setupClickHandler(t) { document.addEventListener("click", (e => { const n = e.target.closest('input[type="submit"], button[type="submit"]'); n && (e.preventDefault(), handleRedirection(t, getUTMParams(), n)) })) } function handleRedirection(t, e, n) { const a = createDynamicLink((t[normalizePath(window.location.pathname)] || appConfig.default).redirectClass || "default", e); window.location.href = a } function paramsToObject(t) { const e = {}; for (const [n, a] of t) e[n] = a; return e } function createDynamicLink(t, e) { const { apn: n, ibi: a, isi: i } = appConfig[t], o = `https://web.auth.kyteapp.com?${new URLSearchParams(e)}`, c = encodeURIComponent(o), r = new URLSearchParams({ link: c, apn: n, ibi: a, isi: i, ct: `${t}_${e.utm_campaign}` }); return Object.entries(e).forEach((([t, e]) => { e && r.set(t, e) })), `https://kyteapp.page.link/?${r.toString()}` } function getUTMParams() { const t = new URLSearchParams(location.search), e = new URLSearchParams(localStorage.getItem("utmParams")), n = {}; return ["utm_source", "utm_medium", "utm_campaign", "utm_content", "utm_term", "gclid"].forEach((a => { n[a] = t.get(a) || e.get(a) || "" })), n } function normalizePath(t) { return t.endsWith("/") ? t.slice(0, -1) : t } const appConfig = { "catalog-redir": { apn: "com.kyte.catalog", ibi: "com.kytecatalog", isi: "6462521196" }, "control-redir": { apn: "com.kytecontrol", ibi: "com.kytecontrol", isi: "6472947922" }, default: { apn: "com.kyte", ibi: "com.kytepos", isi: "1345983058", redirectClass: "default" } }; initializeLandingPageRedirection();